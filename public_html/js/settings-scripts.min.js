$(document).ready(function(){var b={startSaving:function(){$("#saving-settings").show()},endSaving:function(){$("#saving-settings").hide();$("#saved-message").fadeIn().delay(1000).fadeOut()},updateCategory:function(f){b.startSaving();$.ajax({type:"POST",url:"/categories/update",data:f,success:function(){b.endSaving()}})},updateOrder:function(f){$.ajax({type:"POST",url:"/categories/sort_categories",data:f.sortable("serialize")})}},d=(function(){function f(){$(document.body).height($(window).height())}return{init:function(){f();$(window).resize(f);$(document.body).click(function(){$(".cat-editor").remove()});$(".cat-settings-col").click(function(g){g.stopPropagation()})}}}()),e=(function(){function f(){var g=$(this);if(g.hasClass("col-select-1")&&$(document.body).hasClass("layout-2")){b.startSaving();$.ajax({type:"POST",url:"/users/update_layout",data:{layout:1},success:function(){$(document.body).removeClass("layout-2").addClass("layout-1");$(".in-col-2").appendTo($(".cat-settings-col-1"));$(".cat-settings-col-2").remove();b.endSaving()}})}if(g.hasClass("col-select-2")&&$(document.body).hasClass("layout-1")){b.startSaving();$.ajax({type:"POST",url:"/users/update_layout",data:{layout:2},success:function(){$(document.body).removeClass("layout-1").addClass("layout-2");$(".categories-section .content").append('<ul class="cat-settings-col cat-settings-col-2" />');$(".in-col-2").appendTo($(".cat-settings-col-2"));b.endSaving()}})}}return{init:function(){$(".col-select li").click(f)}}}()),a=(function(){var k={placeholder:"ui-settings-placeholder",handle:".cat-handle",connectWith:".cat-settings-col",update:function(l,m){var n=$(this);if(this===m.item.parent()[0]){b.updateOrder(n);b.updateCategory({id:m.item.data("id"),column:n.data("col")})}}};function g(o){var n=$(this),m=$("#new-cat"),l=$("#cat-creator");o.preventDefault();if(l.hasClass("adding-cat")){if(m.val()!==""){$.ajax({type:"POST",url:"/categories/create",data:{category:m.val()},success:function(p){$(p).appendTo($(".cat-settings-col-1"));b.updateOrder($(".cat-settings-col-1"))}})}m.hide().val("");l.removeClass("adding-cat").css("width",0)}else{l.animate({width:152}).addClass("adding-cat");m.fadeIn().focus()}}function j(l){l.preventDefault();$("#add-cat").trigger("click")}function h(){var n=$(this),l=n.parent(),m=['<form class="cat-editor" accept-charset="utf-8" method="post" action="/categories/update">','<input type="text" class="edit-cat-name" value="'+n.html()+'" />','<input type="submit" class="save-cat-name" value="Save">',"</form>"];$(m.join("")).appendTo(l).fadeIn("fast",function(){l.find(".edit-cat-name").focus()})}function f(p){var o=$(this),n=o.parent(),m=n.parent(),l=n.children(".edit-cat-name").val();p.preventDefault();b.updateCategory({id:m.data("id"),category:l});m.children(".cat-name").html(l);n.remove()}function i(m){m.preventDefault();var l=$(this).parent().parent();b.updateCategory({id:l.data("id"),display:(l.hasClass("no-display")?1:0)});l.toggleClass("no-display")}return{init:function(){$(".cat-settings-col").sortable(k);$("#add-cat").click(g);$("#submit-cat").click(j);$(".cat-settings-col").on("click",".cat-name",h);$(".cat-settings-col").on("click",".save-cat-name",f);$(".cat-settings-col").on("click",".toggle-display",i)}}}()),c=function(){d.init();e.init();a.init()};c()});